---
title: config
description: サーバー設定値の管理機能を提供する。
---

## `RuntimeConfig`
サーバー設定値を管理するクラス。  
運用上適切な値を設定することを想定したサーバ設定値を外部から読み込む機能を提供する。
安全な設定値の一元管理と、プロパティによる動的生成を担う。

#### 依存するライブラリ
- **Pydantic / pydantic-settings**: 設定値の型安全管理・読み込みに使用。
- **SQLAlchemy**: DB接続URIの型にこのライブラリの型を使用。

#### 継承元
`pydantic_settings.BaseSettings`

#### クラス属性

| 名前                | 型                                      | 説明                 |
| ------------------- | --------------------------------------- | -------------------- |
| SERVER_NAME         | str                                     | サーバ名             |
| SECRET_KEY          | str                                     | 暗号化用キー         |
| LOG_LEVEL           | str                                     | ログレベル           |
| LOG_FORMAT          | str                                     | ログフォーマット     |
| LOG_DATEFMT         | str                                     | ログ日付フォーマット |
| CELERY              | [CeleryConfig](#configceleryconfig)     | Celery設定           |
| POSTGRES            | [PostgresConfig](#configpostgresconfig) | Postgres設定         |
| MAP_CORE_BASE_URL   | str                                     | mAP CoreサービスURL  |
| WEB_UI_SP_CERT_PATH | str                                     | SP証明書パス         |

#### プロパティ  
これらは `@computed_field` デコレータを使用し、他の属性値から自動的に算出される仕様である。  

| プロパティ名            | 型                    | 説明                                           |
| ----------------------- | --------------------- | ---------------------------------------------- |
| SQLALCHEMY_DATABASE_URI | sqlalchemy.engine.URL | DB接続URI。POSTGRES_で始まる属性値をもとに生成 |


## `CeleryConfig`
Celery関連のサーバー設定値を管理するクラス。[`RuntimeConfig`](#runtimeconfig) でネストした設定値として使用される。

#### 依存するライブラリ
- **Pydantic**: 設定値の型安全管理に使用。

#### 継承元
`pydantic.BaseModel`

#### クラス属性

| 名前           | 型  | 説明                        |
| -------------- | --- | --------------------------- |
| broker_url     | str | CeleryブローカーのURL       |
| result_backend | str | Celery結果バックエンドのURL |


## `PostgresConfig`
Postgres関連のサーバー設定値を管理するクラス。[`RuntimeConfig`](#runtimeconfig) でネストした設定値として使用される。

#### 依存するライブラリ
- **Pydantic**: 設定値の型安全管理に使用。
- **SQLAlchemy**: DB接続URI型に使用。

#### 継承元
`pydantic.BaseModel`

#### クラス属性

| 名前     | 型  | 説明         |
| -------- | --- | ------------ |
| user     | str | DBユーザー名 |
| password | str | DBパスワード |
| host     | str | DBホスト名   |
| port     | int | DBポート番号 |
| db       | str | DB名         |


## `setup_config(path_or_obj: str | RuntimeConfig) -> RuntimeConfig`
サーバー設定を初期化する関数。

#### 引数

| 名前        | 型                                     | 説明                                               |
| ----------- | -------------------------------------- | -------------------------------------------------- |
| path_or_obj | str \| [RuntimeConfig](#runtimeconfig) | 設定ファイルのパス、またはサーバー設定インスタンス |

#### 戻り値

| 型                              | 説明                                 |
| ------------------------------- | ------------------------------------ |
| [RuntimeConfig](#runtimeconfig) | 初期化されたサーバー設定インスタンス |

#### 処理概要
1. 引数 `path_or_obj` が文字列の場合、その値をファイルパスとして設定ファイルを読み込み、
  サーバー設定インスタンス [`RuntimeConfig`](#runtimeconfig) を生成する。
1. [`config`](#config-localproxyruntimeconfig) にサーバー設定インスタンスを格納する。
2. 戻り値としてサーバー設定インスタンスを返す。


## `config: LocalProxy[RuntimeConfig]`
グローバルにアクセス可能なサーバー設定インスタンスの参照。
アプリケーションのどこからでもサーバー設定にアクセスできる。  
[`LocalProxy`](https://werkzeug.palletsprojects.com/en/stable/local/#werkzeug.local.LocalProxy) と 
[`ContextVar`](https://docs.python.org/ja/3.14/library/contextvars.html#contextvars.ContextVar) を使用する。


